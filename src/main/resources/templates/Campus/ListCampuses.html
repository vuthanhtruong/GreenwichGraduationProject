<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List of Campuses</title>
    <link rel="stylesheet" th:href="@{/ListCampuses.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
</head>
<body>
<div class="win11-container">

    <div class="search-toolbar unified-bar">

        <!-- Left: Home -->
        <div class="toolbar-left">
            <a th:href="@{/admin-home}" class="btn home-btn">
                <i class="fas fa-home"></i> Home
            </a>
            <h2 class="page-title">
                <i class="fas fa-university"></i> Campuses Management
            </h2>
        </div>

        <!-- Center: Search -->
        <form method="post"
              th:action="@{/admin-home/campuses-list/search-campuses}"
              class="toolbar-center">
            <select class="input small" name="searchType">
                <option value="name">Name</option>
                <option value="id">ID</option>
            </select>

            <input class="input search-input"
                   name="keyword"
                   placeholder="Search..."
                   type="text">

            <button class="btn small" type="submit">
                <i class="fas fa-search"></i>
            </button>
        </form>

        <!-- Right: Add + Total -->
        <div class="toolbar-right">

            <div class="total">
                <i class="fas fa-layer-group"></i>
                <span><strong>Total:</strong>
                <span th:text="${campuses.size()}">0</span>
            </span>
            </div>

            <button type="button"
                    class="btn primary small"
                    onclick="openOverlay()">
                <i class="fas fa-plus-circle"></i> Add Campus
            </button>
        </div>

    </div>


    <!-- Campus Cards -->
        <section class="win11-panel">
            <h2 class="panel-header">Campuses</h2>
            <div class="campus-grid">
                <div th:unless="${campuses.size() > 0}">
                    <p class="text-center">No campuses available.</p>
                </div>

                <div class="campus-card" th:each="campus : ${campuses}">
                    <div class="avatar-container">
                        <img th:src="@{/admin-home/campuses-list/avatar/{campusId}(campusId=${campus.campusId})}"
                             class="campus-avatar"
                             alt="Campus Avatar"
                             onerror="this.src='/DefaultAvatar/default-campus.png'">
                    </div>
                    <h3 th:text="${campus.campusName}" class="campus-title"></h3>
                    <p><strong>ID:</strong> <span th:text="${campus.campusId}"></span></p>
                    <p><strong>Opening Day:</strong> <span th:text="${campus.openingDay}"></span></p>
                    <p><strong>Description:</strong> <span th:text="${campus.description} ?: 'N/A'"></span></p>
                    <p><strong>Creator:</strong> <span th:text="${campus.creator?.id} ?: 'N/A'"></span></p>
                    <ul class="counts-list">
                        <li><strong>Students:</strong> <span th:text="${campusCounts[campus.campusId]?.studentCount} ?: 0"></span></li>
                        <li><strong>Major Lecturers:</strong> <span th:text="${campusCounts[campus.campusId]?.majorLecturerCount} ?: 0"></span></li>
                        <li><strong>Minor Lecturers:</strong> <span th:text="${campusCounts[campus.campusId]?.minorLecturerCount} ?: 0"></span></li>
                        <li><strong>Major Staff:</strong> <span th:text="${campusCounts[campus.campusId]?.majorStaffCount} ?: 0"></span></li>
                        <li><strong>Deputy Staff:</strong> <span th:text="${campusCounts[campus.campusId]?.deputyStaffCount} ?: 0"></span></li>
                    </ul>
                    <div class="form-actions">
                        <form th:action="@{/admin-home/campuses-list/edit-campus-form}" method="post">
                            <input type="hidden" name="id" th:value="${campus.campusId}">
                            <button type="submit" class="btn"><i class="fas fa-edit"></i> Edit</button>
                        </form>
                        <form th:action="@{/admin-home/campuses-list/delete-campus}" method="post">
                            <input type="hidden" name="id" th:value="${campus.campusId}">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                            <button type="submit" class="btn danger" onclick="return confirm('Are you sure you want to delete this campus?');">
                                <i class="fas fa-trash-alt"></i> Delete
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>

    </div>
</div>

<!-- Overlay Add Campus -->
<div id="addOverlay" class="overlay">
    <div class="overlay-content">
        <h2><i class="fas fa-plus-circle"></i> Add New Campus</h2>
        <form method="post" th:action="@{/admin-home/campuses-list/add-campus}" th:object="${campus}" enctype="multipart/form-data" class="form-group grid-2">
            <div class="form-row">
                <label for="campusName">Campus Name:</label>
                <input id="campusName" class="input" th:field="*{campusName}" type="text" required>
                <div class="error-text" th:each="error : ${errors}" th:if="${error.contains('campusName') or error.contains('Campus Name')}" th:text="${error}"></div>
            </div>
            <div class="form-row">
                <label for="openingDay">Opening Day:</label>
                <input id="openingDay" class="input" th:field="*{openingDay}" type="date">
                <div class="error-text" th:each="error : ${errors}" th:if="${error.contains('openingDay') or error.contains('Opening Day')}" th:text="${error}"></div>
            </div>
            <div class="form-row">
                <label for="description">Description:</label>
                <input id="description" class="input" th:field="*{description}" type="text">
                <div class="error-text" th:each="error : ${errors}" th:if="${error.contains('description') or error.contains('Description')}" th:text="${error}"></div>
            </div>
            <div class="form-row">
                <label for="avatar">Avatar:</label>
                <input id="avatar" class="input" type="file" name="avatarFile" accept="image/*">
                <div class="error-text" th:each="error : ${errors}" th:if="${error.contains('avatar') or error.contains('Avatar')}" th:text="${error}"></div>
            </div>
            <div class="form-actions">
                <button class="btn primary" type="submit">
                    <i class="fas fa-save"></i> Save Campus
                </button>
                <button type="button" class="btn danger" onclick="closeOverlay()">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        </form>
    </div>
</div>

<script>
    function openOverlay() {
        document.getElementById('addOverlay').classList.add('active');
    }
    function closeOverlay() {
        document.getElementById('addOverlay').classList.remove('active');
    }
</script>
<script th:if="${openAddOverlay}">
    document.addEventListener("DOMContentLoaded", function () {
        openOverlay();
    });
</script>
</body>
</html>
