<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List of Campuses</title>
    <link rel="stylesheet" th:href="@{/ListCampuses.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="win98-container">
    <!-- Title Bar -->
    <div class="win98-title-bar">
        <div class="title-text">
            <i class="fas fa-university"></i> List of Campuses
        </div>
    </div>

    <!-- Window Content -->
    <div class="win98-content">
        <!-- Back to Home Button -->
        <div class="win98-toolbar">
            <a class="win98-button" th:href="@{/admin-home}">
                <i class="fas fa-arrow-left"></i> Back to Home
            </a>
        </div>

        <!-- Success or Error Message -->
        <div th:if="${message}" class="win98-alert success">
            <i class="fas fa-check-circle"></i>
            <span th:text="${message}"></span>
        </div>
        <div th:if="${error}" class="win98-alert error">
            <i class="fas fa-exclamation-circle"></i>
            <span th:text="${error}"></span>
        </div>

        <!-- Add Campus Form -->
        <div class="win98-panel">
            <div class="panel-header">Add New Campus</div>
            <form method="post" th:action="@{/admin-home/campuses-list/add-campus}" th:object="${campus}" enctype="multipart/form-data" class="form-row">
                <div class="input-group">
                    <label for="campusName" class="form-label">Campus Name:</label>
                    <input id="campusName" class="win98-input" th:field="*{campusName}" type="text" required />
                    <div class="text-danger" th:if="${#fields.hasErrors('campusName')}" th:errors="*{campusName}"></div>
                    <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('Campus Name')}" th:text="${error}"></div>
                </div>
                <div class="input-group">
                    <label for="openingDay" class="form-label">Opening Day:</label>
                    <input id="openingDay" class="win98-input" th:field="*{openingDay}" type="date" />
                    <div class="text-danger" th:if="${#fields.hasErrors('openingDay')}" th:errors="*{openingDay}"></div>
                    <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('Opening Day')}" th:text="${error}"></div>
                </div>
                <div class="input-group">
                    <label for="description" class="form-label">Description:</label>
                    <input id="description" class="win98-input" th:field="*{description}" type="text" />
                    <div class="text-danger" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
                    <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('Description')}" th:text="${error}"></div>
                </div>
                <div class="input-group">
                    <label for="avatar" class="form-label">Avatar:</label>
                    <input id="avatar" class="win98-input" type="file" name="avatarFile" accept="image/*" />
                    <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('Avatar')}" th:text="${error}"></div>
                </div>
                <div class="input-group align-self-end">
                    <button class="win98-button" type="submit">
                        <i class="fas fa-save"></i> Add Campus
                    </button>
                </div>
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            </form>
        </div>

        <!-- Search Input -->
        <div class="win98-panel">
            <div class="panel-header">Search Campuses</div>
            <form method="post" th:action="@{/admin-home/campuses-list/search-campuses}" class="form-row">
                <div class="input-group">
                    <select class="win98-select" name="searchType">
                        <option value="name">üîç Search by Name</option>
                        <option value="id">üîç Search by ID</option>
                    </select>
                    <input class="win98-input" name="keyword" placeholder="Enter keyword..." type="text">
                    <button class="win98-button" type="submit">
                        <i class="fas fa-search"></i> Search
                    </button>
                </div>
            </form>
        </div>

        <!-- Campuses Cards -->
        <div class="win98-panel">
            <div class="panel-header">Campuses</div>
            <div class="row g-4">
                <div class="col-12" th:unless="${campuses.size() > 0}">
                    <p class="text-center">No campuses available.</p>
                </div>
                <div class="col-md-4 col-sm-6" th:each="campus : ${campuses}">
                    <div class="campus-card">
                        <div class="avatar-container mb-3">
                            <img th:src="@{/admin-home/campuses-list/avatar/{campusId}(campusId=${campus.campusId})}"
                                 th:classappend="${campus.avatar == null} ? 'default-avatar' : ''"
                                 class="campus-avatar"
                                 alt="Campus Avatar"
                                 onerror="this.src='/DefaultAvatar/default-campus.png'" />
                        </div>
                        <h5 th:text="${campus.campusName}" class="campus-title"></h5>
                        <p><strong>ID:</strong> <span th:text="${campus.campusId}"></span></p>
                        <p><strong>Opening Day:</strong> <span th:text="${campus.openingDay}"></span></p>
                        <p><strong>Description:</strong> <span th:text="${campus.description} ?: 'N/A'"></span></p>
                        <p><strong>Creator:</strong> <span th:text="${campus.creator?.id} ?: 'N/A'"></span></p>
                        <ul class="counts-list">
                            <li><strong>Students:</strong> <span th:text="${campusCounts[campus.campusId]?.studentCount} ?: 0"></span></li>
                            <li><strong>Major Lecturers:</strong> <span th:text="${campusCounts[campus.campusId]?.majorLecturerCount} ?: 0"></span></li>
                            <li><strong>Minor Lecturers:</strong> <span th:text="${campusCounts[campus.campusId]?.minorLecturerCount} ?: 0"></span></li>
                            <li><strong>Major Staff:</strong> <span th:text="${campusCounts[campus.campusId]?.majorStaffCount} ?: 0"></span></li>
                            <li><strong>Deputy Staff:</strong> <span th:text="${campusCounts[campus.campusId]?.deputyStaffCount} ?: 0"></span></li>
                        </ul>
                        <div class="d-flex gap-2 mt-3">
                            <form th:action="@{/admin-home/campuses-list/edit-campus-form}" method="post" style="display:inline;">
                                <input type="hidden" name="id" th:value="${campus.campusId}" />
                                <button type="submit" class="win98-button">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </form>
                            <form th:action="@{/admin-home/campuses-list/delete-campus}" method="post" style="display:inline;" th:id="'deleteForm-' + ${campus.campusId}">
                                <input type="hidden" name="id" th:value="${campus.campusId}" />
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                <button type="submit" class="win98-button" onclick="return confirm('Are you sure you want to delete this campus?');">
                                    <i class="fas fa-trash-alt"></i> Delete
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>