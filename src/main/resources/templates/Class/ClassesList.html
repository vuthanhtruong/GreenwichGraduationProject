<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arrange Class</title>
    <link rel="stylesheet" th:href="@{/ClassesList.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
<div class="win11-container">

    <!-- Title Bar -->
    <header class="win11-title-bar">
        <h1><i class="fas fa-chalkboard-teacher"></i> Arrange Class</h1>
    </header>

    <!-- Toolbar -->
    <nav class="win11-toolbar">
        <a th:href="@{/staff-home}" class="btn">
            <i class="fas fa-arrow-left"></i> Back to Home
        </a>
    </nav>

    <!-- Search Classes -->
    <section class="win11-panel">
        <h2 class="panel-header"><i class="fas fa-search"></i> Search Classes</h2>
        <form method="get" th:action="@{/staff-home/classes-list/search-classes}" class="form-row">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <div class="form-group grid-3">
                <select class="input" name="searchType">
                    <option value="name" th:selected="${searchType == 'name'}">By Name</option>
                    <option value="id" th:selected="${searchType == 'id'}">By ID</option>
                </select>
                <input class="input" name="keyword" th:value="${keyword}" placeholder="Enter keyword...">
                <button class="btn primary" type="submit"><i class="fas fa-search"></i> Search</button>
            </div>
        </form>
    </section>

    <!-- Add New Class -->
    <section class="win11-panel">
        <h2 class="panel-header"><i class="fas fa-plus-circle"></i> Add New Class</h2>
        <form method="post" th:action="@{/staff-home/classes-list/add-class}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <div class="form-group grid-3">
                <div class="form-row">
                    <label for="nameClass">Class Name</label>
                    <input id="nameClass" name="nameClass" class="input" required th:value="${nameClass}">
                    <div class="error-text" th:if="${errors != null and errors.contains('Class name cannot be blank.')}">Class name cannot be blank.</div>
                    <div class="error-text" th:if="${errors != null and errors.contains('Class name is already in use.')}">Class name is already in use.</div>
                </div>
                <div class="form-row">
                    <label for="slotQuantity">Total Slots</label>
                    <input id="slotQuantity" name="slotQuantity" class="input" type="number" min="1" required th:value="${slotQuantity}">
                    <div class="error-text" th:if="${errors != null and errors.contains('Total slots cannot be blank.')}">Total slots cannot be blank.</div>
                    <div class="error-text" th:if="${errors != null and errors.contains('Total slots must be greater than 0.')}">Total slots must be greater than 0.</div>
                </div>
                <div class="form-row">
                    <label for="subjectId">Subject</label>
                    <select id="subjectId" name="subjectId" class="input" required>
                        <option value="">Select subject</option>
                        <option th:each="subject : ${subjects}" th:value="${subject.subjectId}" th:text="${subject.subjectName}" th:selected="${subject.subjectId == subjectId}"></option>
                    </select>
                    <div class="error-text" th:if="${errors != null and errors.contains('Subject is required.')}">Subject is required.</div>
                    <div class="error-text" th:if="${errors != null and errors.contains('Invalid subject selected.')}">Invalid subject selected.</div>
                </div>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn primary"><i class="fas fa-save"></i> Save Class</button>
            </div>
        </form>
    </section>

    <!-- Class List -->
    <section class="win11-panel">
        <h2 class="panel-header"><i class="fas fa-list"></i> Class List</h2>

        <!-- Errors -->
        <div th:if="${errors != null}" class="win11-alert error">
            <i class="fas fa-exclamation-circle"></i>
            <ul>
                <li th:each="error : ${errors}" th:text="${error}"></li>
            </ul>
        </div>

        <!-- Page Size -->
        <form method="get" th:action="@{/staff-home/classes-list}" class="form-row inline-form">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <label for="pageSizeInput"><i class="fas fa-list"></i> Show:</label>
            <input id="pageSizeInput" name="pageSize" class="input small" type="number" min="1" max="100" th:value="${pageSize}">
            <button type="submit" class="btn"><i class="fas fa-check"></i> Apply</button>
        </form>

        <!-- Table -->
        <div class="table-container">
            <table class="win11-table">
                <thead>
                <tr>
                    <th>ID</th>
                    <th>Class Name</th>
                    <th>Subject ID</th>
                    <th>Subject Name</th>
                    <th>Total Slot</th>
                    <th>Classroom</th>
                    <th>Actions</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="class : ${classes}">
                    <td th:text="${class.classId}"></td>
                    <td th:text="${class.nameClass}"></td>
                    <td th:text="${class?.subject != null} ? ${class.subject.subjectId} : 'N/A'"></td>
                    <td th:text="${class?.subject != null} ? ${class.subject.subjectName} : 'N/A'"></td>
                    <td th:text="${class.slotQuantity}"></td>
                    <td>
                        <a class="btn small" th:href="@{/classroom/{id}(id=${class.classId})}">
                            <i class="fas fa-eye"></i> View Details
                        </a>
                    </td>
                    <td>
                        <div class="actions">
                            <form th:action="@{/staff-home/classes-list/timetable}" method="post" class="inline-form">
                                <input type="hidden" name="id" th:value="${class.classId}">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                <button class="btn small"><i class="fas fa-edit"></i> Timetable</button>
                            </form>
                            <form th:action="@{/staff-home/classes-list/member-arrangement}" method="post" class="inline-form">
                                <input type="hidden" name="id" th:value="${class.classId}">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                <button class="btn small"><i class="fas fa-users"></i> Members</button>
                            </form>
                            <form th:action="@{/staff-home/classes-list/enter-transcript}" method="post" class="inline-form">
                                <input type="hidden" name="id" th:value="${class.classId}">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                <button class="btn small"><i class="fas fa-file-signature"></i> Transcript</button>
                            </form>
                            <form th:action="@{/staff-home/classes-list/edit-class-form}" method="post" class="inline-form">
                                <input type="hidden" name="id" th:value="${class.classId}">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                <button class="btn small"><i class="fas fa-edit"></i> Edit</button>
                            </form>
                            <form th:action="@{/staff-home/classes-list/delete-class/{classId}(classId=${class.classId})}" method="post"
                                  onsubmit="return confirm('Are you sure you want to delete this class?');" class="inline-form">
                                <input type="hidden" name="_method" value="DELETE">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                                <button class="btn small danger"><i class="fas fa-trash-alt"></i> Delete</button>
                            </form>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination">
            <a class="btn" th:href="@{/staff-home/classes-list(page=1, pageSize=${pageSize})}" th:classappend="${currentPage == 1} ? 'disabled' : ''"><i class="fas fa-angle-double-left"></i></a>
            <a class="btn" th:href="@{/staff-home/classes-list(page=${currentPage - 1}, pageSize=${pageSize})}" th:classappend="${currentPage == 1} ? 'disabled' : ''"><i class="fas fa-angle-left"></i></a>
            <th:block th:each="i : ${#numbers.sequence(1, totalPages)}">
                <a class="btn" th:href="@{/staff-home/classes-list(page=${i}, pageSize=${pageSize})}" th:classappend="${i == currentPage} ? 'active' : ''" th:text="${i}"></a>
            </th:block>
            <a class="btn" th:href="@{/staff-home/classes-list(page=${currentPage + 1}, pageSize=${pageSize})}" th:classappend="${currentPage == totalPages} ? 'disabled' : ''"><i class="fas fa-angle-right"></i></a>
            <a class="btn" th:href="@{/staff-home/classes-list(page=${totalPages}, pageSize=${pageSize})}" th:classappend="${currentPage == totalPages} ? 'disabled' : ''"><i class="fas fa-angle-double-right"></i></a>
        </div>
    </section>
</div>
</body>
</html>
