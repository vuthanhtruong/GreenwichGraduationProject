<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>Member Arrangement</title>
    <link rel="stylesheet" th:href="@{/SyllabusesList.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        .avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .text-center { text-align: center; }
        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn.primary { background: #007bff; color: white; }
        .btn.danger { background: #dc3545; color: white; }
        .btn:disabled { background: #6c757d; cursor: not-allowed; }
        .form-actions { margin-top: 15px; text-align: right; }
        .win11-panel { margin-bottom: 30px; }
        .panel-header { background: #f8f9fa; padding: 12px; border-bottom: 1px solid #dee2e6; font-weight: bold; }
        .table-container { overflow-x: auto; }
        .win11-table { width: 100%; border-collapse: collapse; }
        .win11-table th, .win11-table td { padding: 10px; border: 1px solid #dee2e6; text-align: left; }
        .win11-table th { background: #e9ecef; }
    </style>
</head>
<body>
<div class="win11-container">

    <!-- Unified Toolbar -->
    <div class="search-toolbar unified-bar">
        <div class="toolbar-left">
            <a th:href="@{/staff-home/classes-list}" class="btn home-btn">
                Back to Classes List
            </a>
            <h2 class="page-title">
                Member Arrangement
            </h2>
        </div>
    </div>

    <!-- Flash Messages -->
    <div th:if="${errorMessage != null}" style="padding: 12px; background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 8px; margin-bottom: 20px;">
        <span th:text="${errorMessage}"></span>
    </div>
    <div th:if="${successMessage != null}" style="padding: 12px; background: #d4edda; color: #155724; border: 1px solid #c3e6cb; border-radius: 8px; margin-bottom: 20px;">
        <span th:text="${successMessage}"></span>
    </div>

    <!-- Students in Class -->
    <section class="win11-panel">
        <h2 class="panel-header">Students in Class</h2>
        <form method="post" th:action="@{/staff-home/classes-list/remove-student-from-class}">
            <input type="hidden" name="classId" th:value="${class.classId}"/>
            <input type="hidden" th:name="${_csrf.parameterName}" th:Vvalue="${_csrf.token}"/>
            <div class="table-container">
                <table class="win11-table">
                    <thead>
                    <tr>
                        <th>Select</th>
                        <th>Avatar</th>
                        <th>Name</th>
                        <th>Email</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="student : ${studentsInClass}">
                        <td><input type="checkbox" name="studentIds" th:value="${student.id}"></td>
                        <td class="text-center">
                            <img th:if="${student.avatar != null}" th:src="@{'/staff-home/students-list/avatar/' + ${student.id}}" class="avatar"/>
                            <img th:if="${student.avatar == null}" th:src="${student.defaultAvatarPath}" class="avatar"/>
                        </td>
                        <td th:text="${student.fullName}"></td>
                        <td th:text="${student.email}"></td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(studentsInClass)}">
                        <td colspan="4" class="text-center">No students in this class.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn danger"
                        th:disabled="${#lists.isEmpty(studentsInClass)}">
                    Remove Selected Students
                </button>
            </div>
        </form>
    </section>

    <!-- Lecturers in Class -->
    <section class="win11-panel">
        <h2 class="panel-header">Lecturers in Class</h2>
        <form method="post" th:action="@{/staff-home/classes-list/remove-lecture-from-class}">
            <input type="hidden" name="classId" th:value="${class.classId}"/>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <div class="table-container">
                <table class="win11-table">
                    <thead>
                    <tr>
                        <th>Select</th>
                        <th>Avatar</th>
                        <th>Name</th>
                        <th>Email</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="lecturer : ${lecturersInClass}">
                        <td><input type="checkbox" name="lecturerIds" th:value="${lecturer.id}"></td>
                        <td class="text-center">
                            <img th:if="${lecturer.avatar != null}" th:src="@{'/staff-home/lecturers-list/avatar/' + ${lecturer.id}}" class="avatar"/>
                            <img th:if="${lecturer.avatar == null}" th:src="${lecturer.defaultAvatarPath}" class="avatar"/>
                        </td>
                        <td th:text="${lecturer.fullName}"></td>
                        <td th:text="${lecturer.email}"></td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(lecturersInClass)}">
                        <td colspan="4" class="text-center">No lecturers in this class.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn danger"
                        th:disabled="${#lists.isEmpty(lecturersInClass)}">
                    Remove Selected Lecturers
                </button>
            </div>
        </form>
    </section>

    <!-- Lecturers Not in Class -->
    <section class="win11-panel">
        <h2 class="panel-header">Lecturers Not in Class</h2>
        <form method="post" th:action="@{/staff-home/classes-list/add-lecturers-to-class}">
            <input type="hidden" name="classId" th:value="${class.classId}"/>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <div class="table-container">
                <table class="win11-table">
                    <thead>
                    <tr>
                        <th>Select</th>
                        <th>Avatar</th>
                        <th>Name</th>
                        <th>Email</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="lecturer : ${lecturersNotInClass}">
                        <td><input type="checkbox" name="lecturerIds" th:value="${lecturer.id}"></td>
                        <td class="text-center">
                            <img th:if="${lecturer.avatar != null}" th:src="@{'/staff-home/lecturers-list/avatar/' + ${lecturer.id}}" class="avatar"/>
                            <img th:if="${lecturer.avatar == null}" th:src="${lecturer.defaultAvatarPath}" class="avatar"/>
                        </td>
                        <td th:text="${lecturer.fullName}"></td>
                        <td th:text="${lecturer.email}"></td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(lecturersNotInClass)}">
                        <td colspan="4" class="text-center">No eligible lecturers found.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn primary"
                        th:disabled="${#lists.isEmpty(lecturersNotInClass)}">
                    Add Selected Lecturers
                </button>
            </div>
        </form>
    </section>

    <!-- Students Not in Class or Same Subject -->
    <section class="win11-panel">
        <h2 class="panel-header">Students Not in Class or Same Subject</h2>
        <form method="post" th:action="@{/staff-home/classes-list/add-students-to-class}">
            <input type="hidden" name="classId" th:value="${class.classId}"/>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <div class="table-container">
                <table class="win11-table">
                    <thead>
                    <tr>
                        <th>Select</th>
                        <th>Avatar</th>
                        <th>Name</th>
                        <th>Email</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="student : ${studentsNotInClass}">
                        <td><input type="checkbox" name="studentIds" th:value="${student.id}"></td>
                        <td class="text-center">
                            <img th:if="${student.avatar != null}" th:src="@{'/staff-home/students-list/avatar/' + ${student.id}}" class="avatar"/>
                            <img th:if="${student.avatar == null}" th:src="${student.defaultAvatarPath}" class="avatar"/>
                        </td>
                        <td th:text="${student.fullName}"></td>
                        <td th:text="${student.email}"></td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(studentsNotInClass)}">
                        <td colspan="4" class="text-center">No eligible students found.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn primary"
                        th:disabled="${#lists.isEmpty(studentsNotInClass)}">
                    Add Selected Students
                </button>
            </div>
        </form>
    </section>

    <!-- Students Failed and Paid (Re-study) -->
    <section class="win11-panel">
        <h2 class="panel-header">Students Failed and Paid (Re-study)</h2>
        <form method="post" th:action="@{/staff-home/classes-list/add-students-to-class}">
            <input type="hidden" name="classId" th:value="${class.classId}"/>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <div class="table-container">
                <table class="win11-table">
                    <thead>
                    <tr>
                        <th>Select</th>
                        <th>Avatar</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Registered At</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="student : ${studentsFailedAndPaid}"
                        th:with="retakeEntry=${#lists.find(retakeList, 'student.id', student.id)}">
                        <td><input type="checkbox" name="studentIds" th:value="${student.id}"></td>
                        <td class="text-center">
                            <img th:if="${student.avatar != null}"
                                 th:src="@{'/staff-home/students-list/avatar/' + ${student.id}}" class="avatar"/>
                            <img th:if="${student.avatar == null}"
                                 th:src="${student.defaultAvatarPath}" class="avatar"/>
                        </td>
                        <td th:text="${student.fullName}">N/A</td>
                        <td th:text="${student.email}">N/A</td>
                        <td th:text="${retakeEntry != null ? #temporals.format(retakeEntry.createdAt, 'dd/MM/yyyy HH:mm') : 'N/A'}">N/A</td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(studentsFailedAndPaid)}">
                        <td colspan="5" class="text-center">No students have registered for re-study.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn primary"
                        th:disabled="${#lists.isEmpty(studentsFailedAndPaid)}">
                    Add Selected Students
                </button>
            </div>
        </form>
    </section>

</div>
</body>
</html>