<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Assign Members to Minor Class</title>
    <link rel="stylesheet" th:href="@{/SyllabusesList.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <style>
        .avatar { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; }
        .text-center { text-align: center; }
        .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; margin: 5px; }
        .btn.primary { background: #007bff; color: white; }
        .btn.danger { background: #dc3545; color: white; }
        .btn:disabled { background: #6c757d; cursor: not-allowed; }
        .win11-panel { margin-bottom: 30px; border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden; }
        .panel-header { background: #f8f9fa; padding: 12px; font-weight: bold; border-bottom: 1px solid #dee2e6; }
        .table-container { overflow-x: auto; }
        .win11-table { width: 100%; border-collapse: collapse; }
        .win11-table th, .win11-table td { padding: 10px; border: 1px solid #dee2e6; }
        .win11-table th { background: #e9ecef; }
        .alert { padding: 12px; border-radius: 8px; margin-bottom: 20px; }
        .alert-danger { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .form-actions { padding: 10px; text-align: right; }
    </style>
</head>
<body>
<div class="win11-container">

    <div class="search-toolbar unified-bar">
        <div class="toolbar-left">
            <a th:href="@{/deputy-staff-home}" class="btn home-btn">Home</a>
            <a th:href="@{/deputy-staff-home/minor-classes-list}" class="btn">Minor Classes</a>
            <h2 class="page-title">Assign Members â€“ <span th:text="${class.nameClass}">N/A</span></h2>
        </div>
    </div>

    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>
    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>

    <!-- 1. Students in Class -->
    <section class="win11-panel">
        <h2 class="panel-header">Students in Class</h2>
        <form method="post" th:action="@{/deputy-staff-home/minor-classes-list/remove-student-from-class}">
            <input type="hidden" name="classId" th:value="${class.classId}"/>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <div class="table-container">
                <table class="win11-table">
                    <thead><tr><th>Select</th><th>Avatar</th><th>ID</th><th>Name</th><th>Email</th></tr></thead>
                    <tbody>
                    <tr th:each="smc : ${studentsInClass}">
                        <td><input type="checkbox" name="studentIds" th:value="${smc.student.id}"/></td>
                        <td class="text-center">
                            <img th:if="${smc.student.avatar}" th:src="@{'/deputy-staff-home/students-list/avatar/' + ${smc.student.id}}" class="avatar"/>
                            <img th:unless="${smc.student.avatar}" th:src="${smc.student.defaultAvatarPath}" class="avatar"/>
                        </td>
                        <td th:text="${smc.student.id}"></td>
                        <td th:text="${smc.student.fullName}"></td>
                        <td th:text="${smc.student.email}"></td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(studentsInClass)}">
                        <td colspan="5" class="text-center">No students in this class.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn danger" th:disabled="${#lists.isEmpty(studentsInClass)}">
                    Remove Selected
                </button>
            </div>
        </form>
    </section>

    <!-- 2. Lecturers in Class -->
    <section class="win11-panel">
        <h2 class="panel-header">Lecturers in Class</h2>
        <form method="post" th:action="@{/deputy-staff-home/minor-classes-list/remove-lecturer-from-class}">
            <input type="hidden" name="classId" th:value="${class.classId}"/>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <div class="table-container">
                <table class="win11-table">
                    <thead><tr><th>Select</th><th>Avatar</th><th>ID</th><th>Name</th><th>Email</th></tr></thead>
                    <tbody>
                    <tr th:each="l : ${lecturersInClass}">
                        <td><input type="checkbox" name="lecturerIds" th:value="${l.id}"/></td>
                        <td class="text-center">
                            <img th:if="${l.avatar}" th:src="@{'/deputy-staff-home/lecturers-list/avatar/' + ${l.id}}" class="avatar"/>
                            <img th:unless="${l.avatar}" th:src="${l.defaultAvatarPath}" class="avatar"/>
                        </td>
                        <td th:text="${l.id}"></td>
                        <td th:text="${l.fullName}"></td>
                        <td th:text="${l.email}"></td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(lecturersInClass)}">
                        <td colspan="5" class="text-center">No lecturers in this class.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn danger" th:disabled="${#lists.isEmpty(lecturersInClass)}">
                    Remove Selected
                </button>
            </div>
        </form>
    </section>

    <!-- 3. Lecturers Not in Class -->
    <section class="win11-panel">
        <h2 class="panel-header">Lecturers Not in Class</h2>
        <form method="post" th:action="@{/deputy-staff-home/minor-classes-list/add-lecturer-to-class}">
            <input type="hidden" name="classId" th:value="${class.classId}"/>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <div class="table-container">
                <table class="win11-table">
                    <thead><tr><th>Select</th><th>Avatar</th><th>ID</th><th>Name</th><th>Email</th></tr></thead>
                    <tbody>
                    <tr th:each="l : ${lecturersNotInClass}">
                        <td><input type="checkbox" name="lecturerIds" th:value="${l.id}"/></td>
                        <td class="text-center">
                            <img th:if="${l.avatar}" th:src="@{'/deputy-staff-home/lecturers-list/avatar/' + ${l.id}}" class="avatar"/>
                            <img th:unless="${l.avatar}" th:src="${l.defaultAvatarPath}" class="avatar"/>
                        </td>
                        <td th:text="${l.id}"></td>
                        <td th:text="${l.fullName}"></td>
                        <td th:text="${l.email}"></td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(lecturersNotInClass)}">
                        <td colspan="5" class="text-center">No lecturers available.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn primary" th:disabled="${#lists.isEmpty(lecturersNotInClass)}">
                    Add Selected
                </button>
            </div>
        </form>
    </section>

    <!-- 4. Students Do Not Have Enough Money -->
    <section class="win11-panel">
        <h2 class="panel-header">Students Do Not Have Enough Money</h2>
        <div class="table-container">
            <table class="win11-table">
                <thead><tr><th>Avatar</th><th>ID</th><th>Name</th><th>Email</th></tr></thead>
                <tbody>
                <tr th:each="s : ${studentsDoNotHaveEnoughMoney}">
                    <td class="text-center">
                        <img th:if="${s.avatar}" th:src="@{'/deputy-staff-home/students-list/avatar/' + ${s.id}}" class="avatar"/>
                        <img th:unless="${s.avatar}" th:src="${s.defaultAvatarPath}" class="avatar"/>
                    </td>
                    <td th:text="${s.id}"></td>
                    <td th:text="${s.fullName}"></td>
                    <td th:text="${s.email}"></td>
                </tr>
                <tr th:if="${#lists.isEmpty(studentsDoNotHaveEnoughMoney)}">
                    <td colspan="4" class="text-center">All retake students have enough balance.</td>
                </tr>
                </tbody>
            </table>
        </div>
    </section>

    <!-- 5. Students With Enough Money (Auto-Deduct) -->
    <section class="win11-panel">
        <h2 class="panel-header">Students With Enough Money (Auto-Deduct on Add)</h2>
        <form method="post" th:action="@{/deputy-staff-home/minor-classes-list/add-student-to-class}">
            <input type="hidden" name="classId" th:value="${class.classId}"/>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <div class="table-container">
                <table class="win11-table">
                    <thead><tr><th>Select</th><th>Avatar</th><th>ID</th><th>Name</th><th>Email</th></tr></thead>
                    <tbody>
                    <tr th:each="s : ${studentsWithEnoughMoney}">
                        <td><input type="checkbox" name="studentIds" th:value="${s.id}"/></td>
                        <td class="text-center">
                            <img th:if="${s.avatar}" th:src="@{'/deputy-staff-home/students-list/avatar/' + ${s.id}}" class="avatar"/>
                            <img th:unless="${s.avatar}" th:src="${s.defaultAvatarPath}" class="avatar"/>
                        </td>
                        <td th:text="${s.id}"></td>
                        <td th:text="${s.fullName}"></td>
                        <td th:text="${s.email}"></td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(studentsWithEnoughMoney)}">
                        <td colspan="5" class="text-center">No students can afford retake.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn primary" th:disabled="${#lists.isEmpty(studentsWithEnoughMoney)}">
                    Add & Deduct Payment
                </button>
            </div>
        </form>
    </section>

    <!-- 6. Students Have Paid Tuition and Do Not Have This Class Yet -->
    <section class="win11-panel">
        <h2 class="panel-header">Students Have Paid Tuition and Do Not Have This Class Yet</h2>
        <form method="post" th:action="@{/deputy-staff-home/minor-classes-list/add-student-to-class}">
            <input type="hidden" name="classId" th:value="${class.classId}"/>
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
            <div class="table-container">
                <table class="win11-table">
                    <thead><tr><th>Select</th><th>Avatar</th><th>ID</th><th>Name</th><th>Email</th></tr></thead>
                    <tbody>
                    <tr th:each="r : ${retakeList}">
                        <td><input type="checkbox" name="studentIds" th:value="${r.student.id}"/></td>
                        <td class="text-center">
                            <img th:if="${r.student.avatar}" th:src="@{'/deputy-staff-home/students-list/avatar/' + ${r.student.id}}" class="avatar"/>
                            <img th:unless="${r.student.avatar}" th:src="${r.student.defaultAvatarPath}" class="avatar"/>
                        </td>
                        <td th:text="${r.student.id}"></td>
                        <td th:text="${r.student.fullName}"></td>
                        <td th:text="${r.student.email}"></td>
                    </tr>
                    <tr th:if="${#lists.isEmpty(retakeList)}">
                        <td colspan="5" class="text-center">No students in this list.</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="form-actions">
                <button type="submit" class="btn primary" th:disabled="${#lists.isEmpty(retakeList)}">
                    Add Selected
                </button>
            </div>
        </form>
    </section>

</div>
</body>
</html>