<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Minor Classroom</title>

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" th:href="@{/Classroom.css}"/>
</head>

<body>
<div class="win11-container">

    <!-- ============================
         TOP TOOLBAR
    ============================ -->
    <div class="search-toolbar">

        <!-- LEFT -->
        <div class="toolbar-left">
            <a th:href="@{${home}}" class="btn">
                <i class="fas fa-home"></i> Home
            </a>

            <a th:href="@{${listClass}}" class="btn">
                <i class="fas fa-arrow-left"></i> Back to Class List
            </a>
        </div>

        <!-- CENTER -->
        <div class="toolbar-center">
            <h2 class="page-title">Minor Lecturer Classroom</h2>
        </div>

        <!-- RIGHT -->
        <div class="toolbar-right">

            <th:block th:if="${add}">
                <button type="button" class="btn primary" onclick="openPostOverlay()">
                    <i class="fas fa-upload"></i> Upload Post
                </button>
            </th:block>

            <form method="post" th:action="@{/classroom/members}" style="display:inline;">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <input type="hidden" name="classId" th:value="${classes.classId}"/>
                <button type="submit" class="btn primary">
                    <i class="fas fa-users"></i> Class Members
                </button>
            </form>

        </div>
    </div>

    <!-- ============================
         OVERLAY – CREATE POST
    ============================ -->
    <div id="postOverlay" class="overlay"
         th:classappend="${openPostOverlay} ? 'active'">

        <div class="overlay-content">

            <h2><i class="fas fa-upload"></i> Create New Minor Post</h2>

            <form method="post"
                  th:action="@{${addPostClass}}"
                  th:object="${post}"
                  enctype="multipart/form-data">

                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                <input type="hidden" name="classId" th:value="${classes.classId}"/>

                <div class="form-group">
                    <label><i class="fas fa-comment"></i> Content:</label>
                    <textarea th:field="*{content}" required
                              class="input" rows="5"
                              placeholder="Enter post content..."></textarea>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-file-upload"></i> Attach Files:</label>
                    <input type="file" name="files" multiple
                           accept=".pdf,.doc,.docx,.txt,.ppt,.pptx,.zip"
                           class="input"/>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn primary">
                        <i class="fas fa-save"></i> Save Post
                    </button>

                    <button type="button"
                            class="btn danger"
                            onclick="closePostOverlay()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>

            </form>
        </div>
    </div>

    <!-- ============================
         MAIN LAYOUT
    ============================ -->
    <div class="class-layout">

        <!-- LEFT – DEADLINES (Minor = always empty) -->
        <div class="panel deadline-box">
            <h3><i class="fas fa-clock"></i> Upcoming Deadlines</h3>
            <p>No assignment submission slots for Minor classes.</p>
        </div>

        <!-- RIGHT – POST STREAM -->
        <div>
            <th:block th:each="post : ${ClassPostsList}">

                <div class="post">

                    <!-- Post Header -->
                    <div class="post-header">
                        <img class="post-avatar"
                             th:src="${post.creatorAvatar}"
                             alt="avatar"/>

                        <div class="post-info">
                            <strong th:text="${post.classPostsType} + ' by ' + ${post.creatorName}"></strong>
                            <small th:text="${#temporals.format(post.createdAt, 'dd MMM yyyy HH:mm')}"></small>
                        </div>
                        <!-- Delete Button -->
                        <form th:if="${add}" method="post" th:action="@{/classroom/delete-post}" style="margin-left:auto;">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <input type="hidden" name="postId" th:value="${post.postId}"/>
                            <input type="hidden" name="classId" th:value="${classes.classId}"/>

                            <button th:if="${Id==post.getCreator().getId()}" type="submit" class="btn delete-btn"
                                    onclick="return confirm('Are you sure you want to delete this post?');">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>

                    </div>

                    <!-- Content -->
                    <p th:text="${post.content}"></p>

                    <!-- Documents -->
                    <th:block th:if="${post.documents != null && !post.documents.isEmpty()}">
                        <div class="documents">
                            <strong>Attached Files:</strong>
                            <ul>
                                <li th:each="doc : ${post.documents}">
                                    <a th:href="@{'/documents/' + ${doc.documentId}}"
                                       th:text="${doc.documentTitle}"></a>
                                </li>
                            </ul>
                        </div>
                    </th:block>

                    <!-- ============================
                         COMMENTS SECTION
                    ============================ -->
                    <div class="comments">

                        <strong>Comments (<span th:text="${post.totalComments}"></span>):</strong>

                        <!-- Comment List -->
                        <ul th:if="${post.allCommentsSorted != null && !post.allCommentsSorted.isEmpty()}">
                            <li th:each="comment : ${post.allCommentsSorted}"
                                class="comment-box">

                                <img class="comment-avatar"
                                     th:src="${comment.commenterAvatar}"
                                     alt="avatar"/>

                                <div class="comment-body">
                                    <strong th:text="${comment.commenterName}"></strong>
                                    <span th:text="${comment.content}"></span>
                                    <small th:text="${#temporals.format(comment.createdAt, 'HH:mm dd/MM')}"></small>
                                </div>
                                <form method="post" th:action="@{/classroom/delete-comment}">
                                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                                    <input type="hidden" name="commentId" th:value="${comment.commentId}" />
                                    <input type="hidden" name="classId" th:value="${classes.classId}" />
                                    <input type="hidden" name="comment" th:value="${comment.content}" />
                                    <button type="submit" class="btn delete-btn"
                                            th:if="${Id == comment.getCommenterId()}"
                                            onclick="return confirm('Are you sure you want to delete this comment?');">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </li>
                        </ul>

                        <!-- No Comments -->
                        <p class="text-muted"
                           th:if="${post.allCommentsSorted == null || post.allCommentsSorted.isEmpty()}">
                            No comments yet.
                        </p>

                        <!-- Add Comment -->
                        <form method="post" th:action="@{/classroom/add-comment}">
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                            <input type="hidden" name="classId" th:value="${classes.classId}"/>
                            <input type="hidden" name="postId" th:value="${post.postId}"/>

                            <textarea name="content" required class="input"
                                      rows="2" placeholder="Add a comment..."></textarea>

                            <button type="submit" class="btn primary small" style="margin-top:4px;">
                                Post Comment
                            </button>
                        </form>

                    </div>

                </div>

            </th:block>
        </div>

    </div>
</div>

<script>
    function openPostOverlay() {
        document.getElementById('postOverlay').classList.add('active');
    }

    function closePostOverlay() {
        document.getElementById('postOverlay').classList.remove('active');
    }
</script>

</body>
</html>
