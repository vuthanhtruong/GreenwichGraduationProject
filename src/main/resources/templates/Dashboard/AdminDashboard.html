<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" th:href="@{/AdminDashboard.css}">
</head>
<body class="bg-light">

<div class="container-fluid py-4 px-5">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="h3 mb-0 text-primary">Admin Dashboard</h1>
            <p class="text-muted">Today: <strong th:text="${today}"></strong> | Week <strong th:text="${currentWeek}"></strong>, <strong th:text="${currentYear}"></strong></p>
        </div>
        <div class="text-end">
            <i class="bi bi-shield-lock-fill text-success fs-1"></i>
            <p class="mb-0 text-success fw-bold">System Secure</p>
        </div>
    </div>

    <!-- Critical Alerts -->
    <div th:if="${hasNegativeBalance}" class="alert alert-danger alert-fixed shadow-lg">
        <i class="bi bi-exclamation-triangle-fill"></i>
        <strong th:text="${studentsWithNegativeBalance}"></strong> students have <strong>negative balance</strong>!
    </div>

    <!-- First Row: Key Summary Cards -->
    <div class="row g-4 mb-5">
        <!-- Total Students -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-left-info shadow stat-card h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs fw-bold text-info text-uppercase mb-1">Total Students</div>
                            <div class="h5 mb-0 fw-bold" th:text="${totalStudents}">0</div>
                            <small class="text-success" th:if="${newStudentsThisYear > 0}">
                                +<span th:text="${newStudentsThisYear}"></span> new this year
                            </small>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-people-fill fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total Balance -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-left-success shadow stat-card h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs fw-bold text-success text-uppercase mb-1">Total Student Balance</div>
                            <div class="h5 mb-0 fw-bold text-success">
                                ₫<span th:text="${totalBalanceAll}">0</span>
                            </div>
                            <small>Avg: ₫<span th:text="${averageBalance}">0</span></small>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-wallet2 fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Major Lecturers -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-left-primary shadow stat-card h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs fw-bold text-primary text-uppercase mb-1">Major Lecturers</div>
                            <div class="h5 mb-0 fw-bold" th:text="${totalMajorLecturers}">0</div>
                            <small th:if="${newMajorLecturersThisYear > 0}">+<span th:text="${newMajorLecturersThisYear}"></span> new</small>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-person-workspace fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Minor Lecturers -->
        <div class="col-xl-3 col-md-6">
            <div class="card border-left-warning shadow stat-card h-100">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <div class="text-xs fw-bold text-warning text-uppercase mb-1">Part-time Lecturers</div>
                            <div class="h5 mb-0 fw-bold" th:text="${totalMinorLecturers}">0</div>
                            <small th:if="${newMinorLecturersThisYear > 0}">+<span th:text="${newMinorLecturersThisYear}"></span> new</small>
                        </div>
                        <div class="col-auto">
                            <i class="bi bi-person-clock fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Second Row: Staff & Deputy -->
    <div class="row g-4 mb-5">
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-gradient text-white" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                    <h5 class="mb-0"><i class="bi bi-person-badge"></i> Major Program Staff</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col">
                            <h4 th:text="${totalStaffs}">0</h4>
                            <p>Total Staff</p>
                        </div>
                        <div class="col">
                            <h4 th:text="${newStaffThisYear}">0</h4>
                            <p>New This Year</p>
                        </div>
                        <div class="col">
                            <span class="badge bg-danger fs-5" th:if="${hasMajorWithoutStaff}">
                                <strong th:text="${majorsWithoutStaff}"></strong> majors without staff
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-gradient text-white" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                    <h5 class="mb-0"><i class="bi bi-person-gear"></i> Deputy Staff (Minor Program)</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col">
                            <h4 th:text="${totalDeputyStaffs}">0</h4>
                            <p>Total Deputy Staff</p>
                        </div>
                        <div class="col">
                            <h4 th:text="${newDeputyThisYear}">0</h4>
                            <p>New This Year</p>
                        </div>
                        <div class="col">
                            <span class="badge bg-danger fs-5" th:if="${hasCampusWithoutDeputy}">
                                <strong th:text="${campusesWithoutDeputy}"></strong> campuses without deputy
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Third Row: Student Distribution Charts -->
    <div class="row g-4 mb-5">
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0">Students by Campus</h6>
                </div>
                <div class="card-body chart-container">
                    <canvas id="studentsByCampusChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h6 class="mb-0">Students by Admission Year</h6>
                </div>
                <div class="card-body chart-container">
                    <canvas id="admissionYearChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Fourth Row: Lecturer Charts -->
    <div class="row g-4 mb-5">
        <div class="col-lg-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h6>Major Lecturers by Gender</h6>
                </div>
                <div class="card-body">
                    <canvas id="majorLecturerGenderChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card shadow-sm">
                <div class="card-header bg-warning text-dark">
                    <h6>Minor Lecturers by Gender</h6>
                </div>
                <div class="card-body">
                    <canvas id Zimm="minorLecturerGenderChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card shadow-sm">
                <div class="card-header bg-danger text-white">
                    <h6>Account Balance Distribution</h6>
                </div>
                <div class="card-body">
                    <canvas id="balanceDistributionChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom: Top Lists -->
    <div class="row g-4">
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-dark text-white">
                    <h6><i class="bi bi-trophy"></i> Top 10 Richest Students</h6>
                </div>
                <div class="card-body">
                    <ol class="list-group list-group-numbered">
                        <th:block th:each="s : ${top10HighestBalance}">
                            <li class="list-group-item d-flex justify-content-between">
                                <span th:text="${s[1] + ' ' + s[2]}"></span>
                                <strong class="text-success" th:text="'₫' + ${(s[3])}"></strong>
                            </li>
                        </th:block>
                    </ol>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card shadow-sm">
                <div class="card-header bg-secondary text-white">
                    <h6><i class="bi bi-exclamation-circle"></i> Top 10 Lowest Balance Students</h6>
                </div>
                <div class="card-body">
                    <ol class="list-group list-group-numbered">
                        <th:block th:each="s : ${top10LowestBalance}">
                            <li class="list-group-item d-flex justify-content-between">
                                <span th:text="${s[1] + ' ' + s[2]}"></span>
                                <strong class="text-danger" th:text="'₫' + ${s[3]}"></strong>
                            </li>
                        </th:block>
                    </ol>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Chart.js Scripts -->
<script th:inline="javascript">
    /*<![CDATA[*/

    // Students by Campus
    const campusData = /*[[${studentsByCampus}]]*/ {};
    new Chart(document.getElementById('studentsByCampusChart'), {
        type: 'doughnut',
        data: { labels: Object.keys(campusData), datasets: [{ data: Object.values(campusData), backgroundColor: ['#4e73df','#1cc88a','#36b9cc','#f6c23e','#e74a3b','#858796'] }] },
        options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
    });

    // Admission Year
    const admissionData = /*[[${studentsByAdmissionYear}]]*/ {};
    new Chart(document.getElementById('admissionYearChart'), {
        type: 'bar',
        data: { labels: Object.keys(admissionData), datasets: [{ label: 'Students', data: Object.values(admissionData), backgroundColor: '#1cc88a' }] },
        options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });

    // Major Lecturers Gender
    const majorGender = /*[[${majorLecturersByGender}]]*/ {};
    new Chart(document.getElementById('majorLecturerGenderChart'), {
        type: 'pie',
        data: { labels: Object.keys(majorGender), datasets: [{ data: Object.values(majorGender), backgroundColor: ['#36b9cc', '#f6c23e'] }] },
        options: { responsive: true }
    });

    // Minor Lecturers Gender
    const minorGender = /*[[${minorLecturersByGender}]]*/ {};
    new Chart(document.getElementById('minorLecturerGenderChart'), {
        type: 'pie',
        data: { labels: Object.keys(minorGender), datasets: [{ data: Object.values(minorGender), backgroundColor: ['#e74a3b', '#858796'] }] },
        options: { responsive: true }
    });

    // Balance Distribution
    const balanceDist = /*[[${balanceDistribution}]]*/ {};
    new Chart(document.getElementById('balanceDistributionChart'), {
        type: 'doughnut',
        data: { labels: Object.keys(balanceDist), datasets: [{ data: Object.values(balanceDist), backgroundColor: ['#ff6b6b','#feca57','#48dbfb','#1dd1a1','#54a0ff','#5f27cd'] }] },
        options: { responsive: true }
    });

    /*]]>*/
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>