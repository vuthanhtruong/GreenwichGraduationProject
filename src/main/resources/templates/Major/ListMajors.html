<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Majors Management</title>

    <link rel="stylesheet" th:href="@{/ListMajors.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
</head>
<body>

<div class="win11-container">

    <!-- ============================ TOOLBAR ============================ -->
    <div class="search-toolbar unified-bar">

        <!-- Left -->
        <div class="toolbar-left">
            <a th:href="@{/admin-home}" class="btn home-btn">
                <i class="fas fa-home"></i> Home
            </a>
            <h2 class="page-title">
                <i class="fas fa-graduation-cap"></i> Majors Management
            </h2>
        </div>

        <!-- Center: Search -->
        <form method="post"
              th:action="@{/admin-home/majors-list/search-majors}"
              class="toolbar-center">

            <select class="input small" name="searchType">
                <option value="name">Name</option>
                <option value="id">ID</option>
            </select>

            <input class="input search-input" name="keyword"
                   placeholder="Search..." type="text">

            <button class="btn small" type="submit">
                <i class="fas fa-search"></i>
            </button>
        </form>

        <!-- Right: Add -->
        <div class="toolbar-right">

            <button type="button" class="btn primary small"
                    onclick="openOverlay()">
                <i class="fas fa-plus-circle"></i> Add Major
            </button>
        </div>

    </div>

    <!-- ============================ ALERTS ============================ -->
    <div th:if="${message}" class="win11-alert success">
        <i class="fas fa-check-circle"></i>
        <span th:text="${message}"></span>
    </div>

    <div th:if="${error}" class="win11-alert error">
        <i class="fas fa-exclamation-circle"></i>
        <span th:text="${error}"></span>
    </div>


    <!-- ============================ LIST PANEL ============================ -->
    <section class="win11-panel">
        <h2 class="panel-header">Majors</h2>

        <div class="item-grid">

            <div th:unless="${majors.size() > 0}">
                <p class="text-center">No majors available.</p>
            </div>

            <!-- CARD -->
            <div class="item-card" th:each="major : ${majors}">

                <!-- Avatar -->
                <div class="avatar-container">
                    <img th:src="@{/admin-home/majors-list/avatar/{majorId}(majorId=${major.majorId})}"
                         class="item-avatar"
                         alt="Major Avatar"
                         onerror="this.src='/DefaultAvatar/default-major.png'">
                </div>

                <!-- Info -->
                <h3 class="item-title" th:text="${major.majorName}"></h3>

                <p><strong>ID:</strong> <span th:text="${major.majorId}"></span></p>
                <p><strong>Created Date:</strong> <span th:text="${major.createdDate}"></span></p>
                <p><strong>Creator:</strong> <span th:text="${major.creator?.id} != null ? ${major.creator.id} : 'N/A'"></span></p>

                <!-- Actions -->
                <div class="form-actions">

                    <form th:action="@{/admin-home/majors-list/edit-major-form}" method="post">
                        <input type="hidden" name="id" th:value="${major.majorId}">
                        <button type="submit" class="btn">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </form>

                    <form th:action="@{/admin-home/majors-list/delete-major}" method="post">
                        <input type="hidden" name="id" th:value="${major.majorId}">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <button type="submit" class="btn danger"
                                onclick="return confirm('Are you sure you want to delete this major?');">
                            <i class="fas fa-trash-alt"></i> Delete
                        </button>
                    </form>

                    <form th:action="@{/admin-home/majors-list/specializations-list/view-specializations}" method="post">
                        <input type="hidden" name="id" th:value="${major.majorId}">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                        <button type="submit" class="btn">
                            <i class="fas fa-eye"></i> View Specializations
                        </button>
                    </form>

                </div>

            </div>
        </div>
    </section>

</div>

<!-- ============================ OVERLAY ============================ -->
<div id="addOverlay" class="overlay">
    <div class="overlay-content">

        <h2><i class="fas fa-plus-circle"></i> Add New Major</h2>

        <form method="post"
              th:action="@{/admin-home/majors-list/add-major}"
              th:object="${major}"
              enctype="multipart/form-data"
              class="form-group grid-2">

            <!-- Major Name -->
            <div class="form-row">
                <label for="majorName">Major Name:</label>
                <input id="majorName" class="input" th:field="*{majorName}"
                       type="text" required>

                <div class="error-text"
                     th:each="error : ${errors}"
                     th:if="${error.contains('majorName')}"
                     th:text="${error}"></div>
            </div>

            <!-- Avatar -->
            <div class="form-row">
                <label for="avatar">Avatar:</label>
                <input id="avatar" class="input" type="file" name="avatarFile" accept="image/*">

                <div class="error-text"
                     th:each="error : ${errors}"
                     th:if="${error.contains('avatar')}"
                     th:text="${error}"></div>
            </div>

            <!-- Buttons -->
            <div class="form-actions">
                <button class="btn primary" type="submit">
                    <i class="fas fa-save"></i> Save Major
                </button>
                <button type="button" class="btn danger" onclick="closeOverlay()">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>

            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
        </form>

    </div>
</div>

<!-- ============================ JS ============================ -->
<script>
    function openOverlay() {
        document.getElementById('addOverlay').classList.add('active');
    }
    function closeOverlay() {
        document.getElementById('addOverlay').classList.remove('active');
    }
</script>

<script th:if="${openAddOverlay}">
    document.addEventListener("DOMContentLoaded", openOverlay);
</script>

</body>
</html>
