<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Rooms List</title>
    <link rel="stylesheet" th:href="@{/RoomsList.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
</head>
<body>
<div class="win11-container">

    <!-- Title -->
    <header class="win11-title-bar">
        <h1><i class="fas fa-school"></i> Rooms List</h1>
    </header>

    <!-- Alerts -->
    <div th:if="${message}" class="win11-alert"
         th:classappend="${alertClass}" role="alert" th:text="${message}"></div>

    <!-- Toolbar -->
    <div class="win11-toolbar">
        <div class="actions">
            <a class="btn primary" th:href="@{/staff-home/rooms-list/add-offline-room}">
                <i class="fas fa-plus-circle"></i> Add Room
            </a>
            <a class="btn success" th:href="@{/staff-home/rooms-list/add-online-room}">
                <i class="fas fa-globe"></i> Add Online Room
            </a>
        </div>
        <a class="btn" th:href="@{/staff-home}">
            <i class="fas fa-arrow-left"></i> Home
        </a>
    </div>

    <!-- Search -->
    <section class="win11-panel">
        <h2 class="panel-header"><i class="fas fa-search"></i> Search Rooms</h2>
        <form method="post" th:action="@{/staff-home/SearchRoomsList}" class="form-row inline-form">
            <select class="input" name="searchType">
                <option value="name">Search by Name</option>
                <option value="id">Search by ID</option>
            </select>
            <input class="input" name="keyword" placeholder="Enter keyword..." type="text">
            <button class="btn" type="submit">
                <i class="fas fa-search"></i> Search
            </button>
        </form>
    </section>

    <!-- Sort & PageSize -->
    <section class="win11-panel d-flex gap-3">
        <form th:action="@{/staff-home/rooms-list}" method="get" class="inline-form">
            <label>Sort:</label>
            <select class="input" name="sortOrder" onchange="this.form.submit()">
                <option value="" th:selected="${sortOrder == null}">Default</option>
                <option value="asc" th:selected="${sortOrder == 'asc'}">Old → New</option>
                <option value="desc" th:selected="${sortOrder == 'desc'}">New → Old</option>
            </select>
            <input type="hidden" name="pageOffline" th:value="${currentPageOffline}">
            <input type="hidden" name="pageOnline" th:value="${currentPageOnline}">
        </form>
        <form th:action="@{/staff-home/rooms-list}" method="get" class="inline-form">
            <label>Show:</label>
            <select class="input" name="pageSize" onchange="this.form.submit()">
                <option value="5" th:selected="${pageSize == 5}">5</option>
                <option value="10" th:selected="${pageSize == 10}">10</option>
                <option value="20" th:selected="${pageSize == 20}">20</option>
            </select>
            <input type="hidden" name="pageOffline" th:value="${currentPageOffline}">
            <input type="hidden" name="pageOnline" th:value="${currentPageOnline}">
            <input type="hidden" name="sortOrder" th:value="${sortOrder}">
        </form>
    </section>

    <!-- Delete All -->
    <div class="win11-toolbar">
        <form method="post" onsubmit="return confirm('Delete all offline rooms?');"
              th:action="@{/staff-home/rooms-list/delete-all-offline-rooms}">
            <input type="hidden" name="_method" value="DELETE">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <button class="btn warning"><i class="fas fa-trash"></i> Delete All Offline</button>
        </form>
        <form method="post" onsubmit="return confirm('Delete all online rooms?');"
              th:action="@{/staff-home/rooms-list/delete-all-online-rooms}">
            <input type="hidden" name="_method" value="DELETE">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <button class="btn info"><i class="fas fa-trash"></i> Delete All Online</button>
        </form>
        <form method="post" onsubmit="return confirm('Delete all rooms?');"
              th:action="@{/staff-home/rooms-list/delete-all-rooms}">
            <input type="hidden" name="_method" value="DELETE">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <button class="btn danger"><i class="fas fa-trash"></i> Delete All</button>
        </form>
    </div>

    <div class="row">
        <!-- Offline Rooms -->
        <section class="col-md-6 win11-panel">
            <h3 class="text-primary"><i class="fas fa-chalkboard"></i> Offline Rooms</h3>
            <div class="table-container">
                <table class="win11-table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Address</th>
                        <th>Creator</th>
                        <th>Create Time</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="room, iterStat : ${rooms}">
                        <td th:text="${room.roomId}"></td>
                        <td th:text="${room.roomName}"></td>
                        <td>
                            <a th:if="${room.address}" th:href="@{'https://www.google.com/maps/search/?api=1&query=' + ${encodedAddresses[iterStat.index]}}" target="_blank" th:text="${room.address}"></a>
                            <span th:unless="${room.address}">N/A</span>
                        </td>
                        <td th:text="${room.creator.firstName + ' ' + room.creator.lastName}"></td>
                        <td th:text="${#temporals.format(room.createdAt, 'dd-MM-yyyy HH:mm')}"></td>
                        <td class="actions">
                            <form th:action="@{/staff-home/rooms-list/edit-offline-room}" method="post" class="inline-form">
                                <input type="hidden" name="id" th:value="${room.roomId}">
                                <button class="btn small warning"><i class="fas fa-edit"></i> Edit</button>
                            </form>
                            <form th:action="@{/staff-home/rooms-list/delete-offline-room/{id}(id=${room.roomId})}" method="post" class="inline-form" onsubmit="return confirm('Delete this room?');">
                                <input type="hidden" name="_method" value="DELETE">
                                <button class="btn small danger"><i class="fas fa-trash-alt"></i> Delete</button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <!-- Pagination offline ... giống subjects -->
        </section>

        <!-- Online Rooms -->
        <section class="col-md-6 win11-panel">
            <h3 class="text-success"><i class="fas fa-laptop"></i> Online Rooms</h3>
            <div class="table-container">
                <table class="win11-table">
                    <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Link</th>
                        <th>Creator</th>
                        <th>Create Time</th>
                        <th>Action</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="room : ${roomsonline}">
                        <td th:text="${room.roomId}"></td>
                        <td th:text="${room.roomName}"></td>
                        <td>
                            <a th:if="${room.link}" th:href="${room.link}" target="_blank"
                               th:text="'meet.jit.si/' + ${#strings.substringAfter(room.link,'https://meet.jit.si/')}" class="shortened-link"></a>
                            <span th:unless="${room.link}">N/A</span>
                        </td>
                        <td th:text="${room.creator.firstName + ' ' + room.creator.lastName}"></td>
                        <td th:text="${#temporals.format(room.createdAt, 'dd-MM-yyyy HH:mm')}"></td>
                        <td class="actions">
                            <form th:action="@{/staff-home/rooms-list/edit-online-room}" method="post" class="inline-form">
                                <input type="hidden" name="id" th:value="${room.roomId}">
                                <button class="btn small warning"><i class="fas fa-edit"></i> Edit</button>
                            </form>
                            <form th:action="@{/staff-home/rooms-list/delete-online-room/{id}(id=${room.roomId})}" method="post" class="inline-form" onsubmit="return confirm('Delete this room?');">
                                <input type="hidden" name="_method" value="DELETE">
                                <button class="btn small danger"><i class="fas fa-trash-alt"></i> Delete</button>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <!-- Pagination online ... giống subjects -->
        </section>
    </div>
</div>
</body>
</html>
