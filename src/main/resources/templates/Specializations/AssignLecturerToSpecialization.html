<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assign Lecturers to Specialization</title>
    <link rel="stylesheet" th:href="@{/SyllabusesList.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
</head>
<body>
<div class="win11-container">

    <!-- Title -->
    <header class="win11-title-bar">
        <h1><i class="fas fa-briefcase"></i> Assign Lecturers to <span th:text="${specialization.specializationName}"></span></h1>
    </header>

    <!-- Toolbar -->
    <div class="search-toolbar">
        <div class="toolbar-left">
            <a th:href="@{/staff-home/lecturer-specialization}" class="btn">
                <i class="fas fa-arrow-left"></i> Back to Specialization List
            </a>
        </div>
    </div>

    <!-- Alerts -->
    <div th:if="${successMessage}" class="win11-alert success">
        <i class="fas fa-check-circle"></i>
        <span th:text="${successMessage}"></span>
    </div>
    <div th:if="${errorMessage}" class="win11-alert error">
        <i class="fas fa-exclamation-circle"></i>
        <span th:text="${errorMessage}"></span>
    </div>

    <!-- Lecturers Not Yet Assigned -->
    <section class="win11-panel">
        <h2 class="panel-header"><i class="fas fa-user-plus"></i> Lecturers Not Yet Assigned</h2>
        <form id="addForm" method="post" th:action="@{/staff-home/lecturer-specialization/assign-lecturer/add}" th:if="${specialization != null}">
            <input type="hidden" name="specializationId" th:value="${specialization.specializationId}" />
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

            <div class="table-container">
                <table class="win11-table">
                    <thead>
                    <tr>
                        <th><i class="fas fa-check-square"></i> Select</th>
                        <th><i class="fas fa-user"></i> Name</th>
                        <th><i class="fas fa-envelope"></i> Email</th>
                        <th><i class="fas fa-id-card"></i> ID</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="lecturer : ${lecturersNotAssigned}" th:if="${lecturersNotAssigned != null}">
                        <td><input type="checkbox" name="lecturerIds" th:value="${lecturer.id}"></td>
                        <td th:text="${lecturer.firstName + ' ' + lecturer.lastName}"></td>
                        <td th:text="${lecturer.email}"></td>
                        <td th:text="${lecturer.id}"></td>
                    </tr>
                    <tr th:if="${lecturersNotAssigned == null or lecturersNotAssigned.isEmpty()}">
                        <td colspan="4" class="text-center">No lecturers available to assign.</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn primary"
                        th:disabled="${lecturersNotAssigned == null or lecturersNotAssigned.isEmpty()}">
                    <i class="fas fa-plus"></i> Add Selected Lecturers
                </button>
            </div>
        </form>
    </section>

    <!-- Lecturers Already Assigned -->
    <section class="win11-panel">
        <h2 class="panel-header"><i class="fas fa-user-check"></i> Assigned Lecturers</h2>
        <form id="removeForm" method="post" th:action="@{/staff-home/lecturer-specialization/assign-lecturer/remove}" th:if="${specialization != null}">
            <input type="hidden" name="specializationId" th:value="${specialization.specializationId}" />
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

            <div class="table-container">
                <table class="win11-table">
                    <thead>
                    <tr>
                        <th><i class="fas fa-check-square"></i> Select</th>
                        <th><i class="fas fa-user"></i> Name</th>
                        <th><i class="fas fa-envelope"></i> Email</th>
                        <th><i class="fas fa-id-card"></i> ID</th>
                        <th><i class="fas fa-calendar"></i> Assigned At</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="assignment : ${lecturersAssigned}" th:if="${lecturersAssigned != null}">
                        <td><input type="checkbox" name="lecturerIds" th:value="${assignment.majorLecturer.id}"></td>
                        <td th:text="${assignment.majorLecturer.firstName + ' ' + assignment.majorLecturer.lastName}"></td>
                        <td th:text="${assignment.majorLecturer.email}"></td>
                        <td th:text="${assignment.majorLecturer.id}"></td>
                        <td th:text="${#temporals.format(assignment.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                    </tr>
                    <tr th:if="${lecturersAssigned == null or lecturersAssigned.isEmpty()}">
                        <td colspan="5" class="text-center">No lecturers assigned yet.</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn danger"
                        th:disabled="${lecturersAssigned == null or lecturersAssigned.isEmpty()}">
                    <i class="fas fa-trash"></i> Remove Selected Lecturers
                </button>
            </div>
        </form>
    </section>

</div>

<script>
    document.getElementById('addForm')?.addEventListener('submit', function (e) {
        const checked = document.querySelectorAll('#addForm input[name="lecturerIds"]:checked');
        if (checked.length === 0) {
            e.preventDefault();
            alert('Please select at least one lecturer to assign.');
        }
    });

    document.getElementById('removeForm')?.addEventListener('submit', function (e) {
        const checked = document.querySelectorAll('#removeForm input[name="lecturerIds"]:checked');
        if (checked.length === 0) {
            e.preventDefault();
            alert('Please select at least one lecturer to remove.');
        }
    });
</script>
</body>
</html>