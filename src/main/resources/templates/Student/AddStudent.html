<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Add Student</title>
    <link rel="stylesheet" th:href="@{/AddStudent.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .parent-entry {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <h1 class="text-center text-primary">
        <i class="fas fa-user-plus"></i> Add New Student
    </h1>

    <form class="mt-4" method="post" th:action="@{/staff-home/students-list/add-student}" th:object="${student}" enctype="multipart/form-data">
        <!-- Error Messages -->
        <div th:if="${errors != null}" class="alert alert-danger">
            <h5>Errors:</h5>
            <ul>
                <li th:each="error : ${errors}" th:text="${error}"></li>
            </ul>
        </div>

        <!-- Avatar -->
        <div class="mb-3">
            <label for="avatarFile" class="form-label">Avatar:</label>
            <input id="avatarFile" class="form-control" type="file" name="avatarFile" accept="image/*">
            <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('avatar')}" th:text="${error}"></div>
            <div th:if="${session.tempAvatarName}" class="form-text text-muted">
                Previously selected file: <span th:text="${session.tempAvatarName}"></span>
                (will be used unless a new file is selected)
            </div>
        </div>

        <!-- Student Information -->
        <h4 class="text-primary">Student Information</h4>
        <!-- First Name -->
        <div class="mb-3">
            <label for="firstName" class="form-label">First Name:</label>
            <input id="firstName" class="form-control" th:field="*{firstName}" required type="text">
            <div class="text-danger" th:if="${#fields.hasErrors('firstName')}" th:errors="*{firstName}"></div>
            <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('First name') and !error.contains('Parent')}" th:text="${error}"></div>
        </div>

        <!-- Last Name -->
        <div class="mb-3">
            <label for="lastName" class="form-label">Last Name:</label>
            <input id="lastName" class="form-control" th:field="*{lastName}" required type="text">
            <div class="text-danger" th:if="${#fields.hasErrors('lastName')}" th:errors="*{lastName}"></div>
            <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('Last name') and !error.contains('Parent')}" th:text="${error}"></div>
        </div>

        <!-- Email -->
        <div class="mb-3">
            <label for="email" class="form-label">Email to contact:</label>
            <input id="email" class="form-control" th:field="*{email}" required type="email">
            <div class="text-danger" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
            <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('email') and !error.contains('Parent')}" th:text="${error}"></div>
            <small class="form-text text-muted">
                After completing the additional information, the system will automatically send an email containing the student's account information and login password.
            </small>
        </div>

        <!-- Phone Number -->
        <div class="mb-3">
            <label for="phoneNumber" class="form-label">Phone Number:</label>
            <input id="phoneNumber" class="form-control" th:field="*{phoneNumber}" required type="text">
            <div class="text-danger" th:if="${#fields.hasErrors('phoneNumber')}" th:errors="*{phoneNumber}"></div>
            <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('phone number') and !error.contains('Parent')}" th:text="${error}"></div>
        </div>

        <!-- MIS ID -->
        <div class="mb-3">
            <label for="misId" class="form-label">MIS ID:</label>
            <input id="misId" class="form-control" th:field="*{misId}" type="text">
            <div class="text-danger" th:if="${#fields.hasErrors('misId')}" th:errors="*{misId}"></div>
        </div>

        <!-- Birth Date -->
        <div class="mb-3">
            <label for="birthDate" class="form-label">Birth Date:</label>
            <input id="birthDate" class="form-control" th:field="*{birthDate}" type="date">
            <div class="text-danger" th:if="${#fields.hasErrors('birthDate')}" th:errors="*{birthDate}"></div>
            <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('Date of birth')}" th:text="${error}"></div>
        </div>

        <!-- Gender -->
        <div class="mb-3">
            <label for="gender" class="form-label">Gender:</label>
            <select id="gender" class="form-control" th:field="*{gender}">
                <option value="">Select gender</option>
                <option th:each="gender : ${T(com.example.demo.entity.Enums.Gender).values()}"
                        th:value="${gender}" th:text="${gender}"></option>
            </select>
            <div class="text-danger" th:if="${#fields.hasErrors('gender')}" th:errors="*{gender}"></div>
        </div>

        <!-- Country -->
        <div class="mb-3">
            <label for="country" class="form-label">Country:</label>
            <input id="country" class="form-control" th:field="*{country}" type="text">
            <div class="text-danger" th:if="${#fields.hasErrors('country')}" th:errors="*{country}"></div>
        </div>

        <!-- Province -->
        <div class="mb-3">
            <label for="province" class="form-label">Province:</label>
            <input id="province" class="form-control" th:field="*{province}" type="text">
            <div class="text-danger" th:if="${#fields.hasErrors('province')}" th:errors="*{province}"></div>
        </div>

        <!-- City -->
        <div class="mb-3">
            <label for="city" class="form-label">City:</label>
            <input id="city" class="form-control" th:field="*{city}" type="text">
            <div class="text-danger" th:if="${#fields.hasErrors('city')}" th:errors="*{city}"></div>
        </div>

        <!-- District -->
        <div class="mb-3">
            <label for="district" class="form-label">District:</label>
            <input id="district" class="form-control" th:field="*{district}" type="text">
            <div class="text-danger" th:if="${#fields.hasErrors('district')}" th:errors="*{district}"></div>
        </div>

        <!-- Ward -->
        <div class="mb-3">
            <label for="ward" class="form-label">Ward:</label>
            <input id="ward" class="form-control" th:field="*{ward}" type="text">
            <div class="text-danger" th:if="${#fields.hasErrors('ward')}" th:errors="*{ward}"></div>
        </div>

        <!-- Street -->
        <div class="mb-3">
            <label for="street" class="form-label">Street/House Number:</label>
            <input id="street" class="form-control" th:field="*{street}" type="text">
            <div class="text-danger" th:if="${#fields.hasErrors('street')}" th:errors="*{street}"></div>
        </div>

        <!-- Postal Code -->
        <div class="mb-3">
            <label for="postalCode" class="form-label">Postal Code:</label>
            <input id="postalCode" class="form-control" th:field="*{postalCode}" type="text">
            <div class="text-danger" th:if="${#fields.hasErrors('postalCode')}" th:errors="*{postalCode}"></div>
        </div>

        <!-- Parent's Information -->
        <div class="mb-3">
            <h4 class="text-primary">Parent's Information (Optional)</h4>
            <small class="form-text text-muted">
                You can provide any or all of the following fields for up to two parents. If provided, the information must be valid.
            </small>

            <!-- Parent 1 -->
            <div class="parent-entry">
                <h5>Parent 1</h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="parentEmail1" class="form-label">Parent 1 Email:</label>
                        <input id="parentEmail1" class="form-control" name="parentEmail1" type="email" th:value="${parentEmail1}">
                        <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('Parent 1') and error.contains('email')}" th:text="${error}"></div>
                        <small class="form-text text-muted">
                            If provided, the system will send an email with the parent's account information and login password for new accounts.
                        </small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="supportPhoneNumber1" class="form-label">Parent 1 Support Phone Number:</label>
                        <input id="supportPhoneNumber1" class="form-control" name="supportPhoneNumber1" type="text" th:value="${supportPhoneNumber1}">
                        <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('Parent 1') and error.contains('Support phone number')}" th:text="${error}"></div>
                        <small class="form-text text-muted">
                            Provide a phone number for supporting the student, if applicable.
                        </small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="parentRelationship1" class="form-label">Parent 1 Relationship to Student:</label>
                        <select id="parentRelationship1" class="form-control" name="parentRelationship1">
                            <option value="" th:selected="${parentRelationship1 == null || parentRelationship1 == ''}">Select relationship</option>
                            <option th:each="relationship : ${relationshipTypes}"
                                    th:value="${relationship}" th:text="${relationship}" th:selected="${parentRelationship1 == relationship.toString()}"></option>
                        </select>
                        <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('Parent 1') and error.contains('Relationship')}" th:text="${error}"></div>
                    </div>
                </div>
            </div>

            <!-- Parent 2 -->
            <div class="parent-entry">
                <h5>Parent 2</h5>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="parentEmail2" class="form-label">Parent 2 Email:</label>
                        <input id="parentEmail2" class="form-control" name="parentEmail2" type="email" th:value="${parentEmail2}">
                        <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('Parent 2') and error.contains('email')}" th:text="${error}"></div>
                        <small class="form-text text-muted">
                            If provided, the system will send an email with the parent's account information and login password for new accounts.
                        </small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="supportPhoneNumber2" class="form-label">Parent 2 Support Phone Number:</label>
                        <input id="supportPhoneNumber2" class="form-control" name="supportPhoneNumber2" type="text" th:value="${supportPhoneNumber2}">
                        <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('Parent 2') and error.contains('Support phone number')}" th:text="${error}"></div>
                        <small class="form-text text-muted">
                            Provide a phone number for supporting the student, if applicable.
                        </small>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="parentRelationship2" class="form-label">Parent 2 Relationship to Student:</label>
                        <select id="parentRelationship2" class="form-control" name="parentRelationship2">
                            <option value="" th:selected="${parentRelationship2 == null || parentRelationship2 == ''}">Select relationship</option>
                            <option th:each="relationship : ${relationshipTypes}"
                                    th:value="${relationship}" th:text="${relationship}" th:selected="${parentRelationship2 == relationship.toString()}"></option>
                        </select>
                        <div class="text-danger" th:each="error : ${errors}" th:if="${error.contains('Parent 2') and error.contains('Relationship')}" th:text="${error}"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="text-center">
            <button class="btn btn-success" type="submit">
                <i class="fas fa-save"></i> Save Student
            </button>
            <a class="btn btn-secondary" th:href="@{/staff-home/students-list}">
                <i class="fas fa-arrow-left"></i> Back to List
            </a>
        </div>
    </form>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>