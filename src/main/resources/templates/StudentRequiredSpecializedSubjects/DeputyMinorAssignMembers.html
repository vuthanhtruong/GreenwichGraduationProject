<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Assign Students - Minor Subject</title>
    <link rel="stylesheet" th:href="@{/SyllabusesList.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
</head>
<body>
<div class="win11-container">

    <div class="search-toolbar unified-bar">
        <div class="toolbar-left">
            <a th:href="@{/deputy-staff-home}" class="btn home-btn">Home</a>
            <a th:href="@{/deputy-staff-home/minor-study-plan}" class="btn small">
                <i class="fas fa-arrow-left"></i> Back to List
            </a>
            <h2 class="page-title">
                Assign Students to: <strong th:text="${subject.subjectName}"></strong>
            </h2>
        </div>
    </div>


    <!-- Assigned Students -->
    <div class="table-container">
        <h2><i class="fas fa-user-check"></i> Assigned Students
            (<span th:text="${#lists.size(assignedStudents)}"></span>)
        </h2>
        <form th:action="@{/deputy-staff-home/minor-study-plan/assign/remove}" method="post">
            <input type="hidden" name="subjectId" th:value="${subject.subjectId}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <table class="win11-table">
                <thead>
                <tr>
                    <th><input type="checkbox" onclick="toggle(this, 'studentIds')"></th>
                    <th>Student ID</th>
                    <th>Full Name</th>
                    <th>Assigned By</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="assign : ${assignedStudents}">
                    <td><input type="checkbox" name="studentIds" th:value="${assign.student.id}"></td>
                    <td th:text="${assign.student.id}"></td>
                    <td th:text="${assign.student.firstName + ' ' + assign.student.lastName}"></td>
                    <td th:text="${assign.assignedBy?.fullName ?: 'N/A'}"></td>
                </tr>
                <tr th:if="${#lists.isEmpty(assignedStudents)}">
                    <td colspan="4" class="text-center">No students assigned yet.</td>
                </tr>
                </tbody>
            </table>
            <button type="submit" class="btn danger"
                    th:disabled="${#lists.isEmpty(assignedStudents)}">
                <i class="fas fa-user-minus"></i> Remove Selected
            </button>
        </form>
    </div>

    <!-- Available Students -->
    <div class="table-container">
        <h2><i class="fas fa-user-plus"></i> Available Students
            (<span th:text="${#lists.size(availableStudents)}"></span>)
        </h2>
        <form th:action="@{/deputy-staff-home/minor-study-plan/assign/add}" method="post">
            <input type="hidden" name="subjectId" th:value="${subject.subjectId}">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <table class="win11-table">
                <thead>
                <tr>
                    <th><input type="checkbox" onclick="toggle(this, 'studentIds')"></th>
                    <th>Student ID</th>
                    <th>Full Name</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="student : ${availableStudents}">
                    <td><input type="checkbox" name="studentIds" th:value="${student.id}"></td>
                    <td th:text="${student.id}"></td>
                    <td th:text="${student.firstName + ' ' + student.lastName}"></td>
                </tr>
                <tr th:if="${#lists.isEmpty(availableStudents)}">
                    <td colspan="3" class="text-center">All students are already assigned.</td>
                </tr>
                </tbody>
            </table>
            <button type="submit" class="btn primary"
                    th:disabled="${#lists.isEmpty(availableStudents)}">
                <i class="fas fa-user-plus"></i> Assign Selected
            </button>
        </form>
    </div>

    <script>
        function toggle(master, name) {
            document.querySelectorAll(`input[name="${name}"]`).forEach(cb => cb.checked = master.checked);
        }
    </script>

</div>
</body>
</html>