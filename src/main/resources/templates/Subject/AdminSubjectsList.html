<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Subjects</title>
    <link rel="stylesheet" th:href="@{/SubjectsList.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
</head>
<body>
<div class="win98-container">
    <!-- Title Bar -->
    <div class="win98-title-bar">
        <div class="title-text">
            <i class="fas fa-book"></i> Manage Subjects
        </div>
    </div>

    <!-- Window Content -->
    <div class="win98-content">
        <!-- Navigation Toolbar -->
        <div class="win98-toolbar">
            <a th:href="@{/admin-home}" class="win98-button">
                <i class="fas fa-arrow-left"></i> Back to Admin Home
            </a>
        </div>

        <!-- Messages -->
        <div th:if="${successMessage != null}" class="win98-alert success">
            <i class="fas fa-check-circle"></i>
            <span th:text="${successMessage}"></span>
        </div>
        <div th:if="${errorMessage != null}" class="win98-alert error">
            <i class="fas fa-exclamation-circle"></i>
            <span th:text="${errorMessage}"></span>
        </div>

        <!-- Admission Year Selector -->
        <div class="win98-panel">
            <div class="panel-header">Select Admission Year</div>
            <form method="post" th:action="@{/admin-home/subjects-list}" class="form-row">
                <div class="input-group">
                    <label for="admissionYear" class="form-label">Admission Year:</label>
                    <select id="admissionYear" name="admissionYear" class="win98-select" onchange="this.form.submit()">
                        <option value="" disabled th:unless="${admissionYears.size() > 0}">No years available</option>
                        <option th:each="year : ${admissionYears}"
                                th:value="${year}"
                                th:text="${year}"
                                th:selected="${year == selectedYear}"></option>
                    </select>
                </div>
            </form>
        </div>

        <!-- Subjects Table Section -->
        <div class="win98-panel">
            <div class="panel-header">Subjects for <span th:text="${selectedYear}"></span></div>
            <form th:action="@{/admin-home/update-tuition}" method="post">
                <input type="hidden" name="admissionYear" th:value="${selectedYear}">
                <div class="table-container full-width">
                    <table class="win98-table">
                        <thead>
                        <tr>
                            <th>Subject ID</th>
                            <th>Subject Name</th>
                            <th>Semester</th>
                            <th>Type</th>
                            <th>Major</th>
                            <th>Acceptor</th>
                            <th>Tuition Fee</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="subject : ${allSubjects}">
                            <td th:text="${subject.subjectId}"></td>
                            <td th:text="${subject.subjectName}"></td>
                            <td th:text="${subject.semester != null} ? ${subject.semester} : 'N/A'"></td>
                            <td th:text="${subject instanceof T(com.example.demo.subject.model.MajorSubjects)} ? 'Major' : 'Minor'"></td>
                            <td th:text="${subject instanceof T(com.example.demo.subject.model.MajorSubjects)} ? (${subject.major != null} ? ${subject.major.majorName} : 'N/A') : 'N/A'"></td>
                            <td th:text="${subject.acceptor != null} ? ${subject.acceptor.getFullName()} : 'N/A'"></td>
                            <td>
                                <input type="number" class="win98-input tuition-input"
                                       th:name="'tuitionFee_' + ${subject.subjectId}"
                                       th:value="${tuitionFeeMap.containsKey(subject.subjectId)} ? ${tuitionFeeMap.get(subject.subjectId)}"
                                       placeholder="Enter fee" min="0" step="0.01">
                            </td>
                        </tr>
                        <tr th:unless="${allSubjects.size() > 0}">
                            <td colspan="7" class="text-center">No Subjects available</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="win98-toolbar">
                    <button type="submit" class="win98-button">
                        <i class="fas fa-save"></i> Save Tuition Fees
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
</body>
</html>